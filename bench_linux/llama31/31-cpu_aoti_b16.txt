python3 torchchat.py export llama3.1 --quantize '{"precision": {"dtype":"bfloat16"}, "executor":{"accelerator":"cpu"}}' --output-dso-path /tmp/model16.so
python3 torchchat.py generate llama3.1 --dso-path /tmp/model16.so --prompt "Once upon a time," --max-new-tokens 256 --device cpu --num-samples 3
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
python3 torchchat.py export llama3.1 --quantize '{"precision": {"dtype":"bfloat16"}, "executor":{"accelerator":"cpu"}}' --output-dso-path /tmp/model16.so
Note: NumExpr detected 22 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 16.
NumExpr defaulting to 16 threads.
PyTorch version 2.5.0.dev20240728+cu121 available.
Using device=cpu
Setting max_seq_length to 300 for DSO export.
Loading model...
Time to load model: 0.37 seconds
Quantizing the model with: {'precision': {'dtype': 'bfloat16'}, 'executor': {'accelerator': 'cpu'}}
Time to quantize model: 0.01 seconds
-----------------------------------------------------------
Exporting model using AOT Inductor to /tmp/model16.so
The generated DSO model can be found at: /tmp/model16.so
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
python3 torchchat.py generate llama3.1 --dso-path /tmp/model16.so --prompt "Once upon a time," --max-new-tokens 256 --device cpu --num-samples 3
Note: NumExpr detected 22 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 16.
NumExpr defaulting to 16 threads.
PyTorch version 2.5.0.dev20240728+cu121 available.
Warning: checkpoint path ignored because an exported DSO or PTE path specified
Warning: checkpoint path ignored because an exported DSO or PTE path specified
Using device=cpu Intel(R) Xeon(R) Platinum 8339HC CPU @ 1.80GHz
Loading model...
Time to load model: 0.37 seconds
-----------------------------------------------------------
Once upon a time, in a small village nestled in the rolling hills of Provence, there lived a young girl named Sophie. Sophie was a creative and curious child, with a heart full of love for nature and a mind full of wonder. She spent her days exploring the fields and forests surrounding her village, gathering wildflowers, and watching the animals that lived there.
One day, while wandering through the woods, Sophie stumbled upon a hidden clearing. In the center of the clearing stood an ancient tree, its branches twisted and gnarled with age. Sophie felt drawn to the tree, as if it was calling to her. She approached it cautiously, feeling the rough bark beneath her fingers.
As she reached out to touch the tree, a tiny door materialized on its trunk. The door was no bigger than Sophie's hand, and it was adorned with intricate carvings of leaves and flowers. Sophie's eyes widened as she reached out to open the door.
 Inside the tree, Sophie found a cozy little room filled with soft, golden light. The room was dominated by a beautiful music box, its lid open, revealing a delicate ballerina twirling to the tune of a soft, melancholy melody. Sophie's heart swelled with joy as she watched the ballerina dance.

Time for inference 1: 180.51 sec total, time to first token 11.83 sec with sequential prefill, 255 tokens, 1.41 tokens/sec, 707.87 ms/token
Bandwidth achieved: 22.69 GB/s
*** This first iteration will include cold start effects for dynamic import, hardware caches. ***
Once upon a time, there was a young man named Rohan who lived in a small village surrounded by vast fields of golden wheat. Rohan was known for his boundless energy and his ability to run faster than anyone else in the village.

One day, a wise old man came to the village and challenged Rohan to a race. The old man was known for his wisdom and his ability to run at incredible speeds, but he was also known to be a bit mysterious and nobody knew his true identity.

Rohan, feeling confident in his own abilities, accepted the challenge. The two of them agreed to run a race across the fields, with the finish line marked by a small tree at the top of a hill.

As they lined up at the starting line, the wise old man handed Rohan a small piece of paper with a cryptic message on it. The message read:

"Trust your shadow, not your eyes."

Rohan was confused by the message, but he didn't have time to think about it too much. The old man shouted "Ready, set, go!" and they both took off like lightening.

The first part of the race was a blur, with both runners sprinting across the fields at incredible speeds. But as they approached the halfway point, Rohan
Time for inference 2: 176.65 sec total, time to first token 2.22 sec with sequential prefill, 255 tokens, 1.44 tokens/sec, 692.74 ms/token
Bandwidth achieved: 23.18 GB/s
Once upon a time, in a far-off land, there was a magical kingdom where the air was sweet with the scent of flowers and the sun shone brightly every day. The kingdom was ruled by a wise and just king who loved his people and did everything in his power to make their lives happy and prosperous.
One day, a group of brave and adventurous knights arrived in the kingdom, seeking adventure and fortune. The king, being a just and fair ruler, welcomed the knights and invited them to join him in his castle for a grand feast in their honor.
As the knights sat down to eat, they were amazed by the feast spread before them. There were all sorts of delicious dishes, from juicy meats to sweet pastries, and the air was filled with the sounds of laughter and music.
Just as the feast was about to begin, a mysterious figure appeared at the door. It was a beautiful and cunning sorceress who had been banished from the kingdom many years ago. The sorceress was known for her magical powers and her ability to cast spells that could bring great harm or great good.
The king, being a wise and just ruler, knew that the sorceress was a troublemaker and would only bring harm to his kingdom and his people. So, he ordered his
Time for inference 3: 210.71 sec total, time to first token 3.37 sec with sequential prefill, 255 tokens, 1.21 tokens/sec, 826.30 ms/token
Bandwidth achieved: 19.44 GB/s

========================================

Average tokens/sec: 1.36
Memory used: 0.00 GB

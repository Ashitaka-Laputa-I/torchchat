python3 torchchat.py export llama3 --quantize '{"precision": {"dtype":"bfloat16"}, "executor":{"accelerator":"cpu"}}' --output-dso-path /tmp/model16.so
python3 torchchat.py generate llama3 --dso-path /tmp/model16.so --prompt "Once upon a time," --max-new-tokens 256 --device cpu --num-samples 3
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
python3 torchchat.py export llama3 --quantize '{"precision": {"dtype":"bfloat16"}, "executor":{"accelerator":"cpu"}}' --output-dso-path /tmp/model16.so
Note: NumExpr detected 22 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 16.
NumExpr defaulting to 16 threads.
PyTorch version 2.5.0.dev20240728+cu121 available.
Using device=cpu
Setting max_seq_length to 300 for DSO export.
Loading model...
Time to load model: 0.38 seconds
Quantizing the model with: {'precision': {'dtype': 'bfloat16'}, 'executor': {'accelerator': 'cpu'}}
Time to quantize model: 0.01 seconds
-----------------------------------------------------------
Exporting model using AOT Inductor to /tmp/model16.so
The generated DSO model can be found at: /tmp/model16.so
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
python3 torchchat.py generate llama3 --dso-path /tmp/model16.so --prompt "Once upon a time," --max-new-tokens 256 --device cpu --num-samples 3
Note: NumExpr detected 22 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 16.
NumExpr defaulting to 16 threads.
PyTorch version 2.5.0.dev20240728+cu121 available.
Warning: checkpoint path ignored because an exported DSO or PTE path specified
Warning: checkpoint path ignored because an exported DSO or PTE path specified
Using device=cpu Intel(R) Xeon(R) Platinum 8339HC CPU @ 1.80GHz
Loading model...
Time to load model: 0.40 seconds
-----------------------------------------------------------
Once upon a time, in a small village, there lived a young girl named Maria. Maria was a kind and gentle soul, with a heart full of love and compassion. She was especially fond of animals, and spent most of her days helping her mother with the animals on their farm.
One day, while Maria was out in the fields, she came across a small bird that had fallen from its nest. The bird was injured and couldn't fly. Maria knew that she had to help the bird, so she carefully picked it up and took it back to her farmhouse.
Maria's mother, who was a wise and experienced healer, examined the bird and determined that it had a broken wing. She sent Maria to gather some special herbs and plants that would help the bird heal. Maria set off immediately, searching high and low for the right ingredients.
Finally, she returned with a basket full of herbs and plants, which her mother used to create a special potion. The potion was extremely effective, and soon the bird's wing began to heal. As the days passed, the bird grew stronger and stronger, until it was finally able to fly once again.
The bird, who had named itself Luna, was forever grateful to Maria for saving its life. From that day on, Luna became Maria's loyal
Time for inference 1: 236.08 sec total, time to first token 8.70 sec with sequential prefill, 255 tokens, 1.08 tokens/sec, 925.82 ms/token
Bandwidth achieved: 17.35 GB/s
*** This first iteration will include cold start effects for dynamic import, hardware caches. ***
Once upon a time, there was a young girl named Sophia. She lived in a small village at the foot of a mountain. Sophia loved to explore the world around her, and she spent most of her days wandering through the woods, discovering hidden streams and secret meadows.
One day, Sophia stumbled upon a hidden cave deep in the forest. The cave was dark and damp, and Sophia hesitated for a moment before stepping inside. But she soon found herself drawn to the cave's strange and wondrous beauty. The walls were covered in glittering crystals and shimmering minerals, and the air was filled with the sweet scent of incense.

As Sophia explored the cave, she began to notice that the crystals and minerals seemed to be changing color, as if they were reacting to her presence. The air around her began to shimmer and glow, and Sophia felt a strange energy building up inside her.

Suddenly, a figure appeared before her. It was an old man, dressed in a long white robe, with a kind face and piercing blue eyes.

"Who are you?" Sophia asked, startled.

"I am the guardian of this cave," the old man replied. "And you, Sophia, are the chosen one. You have been brought here for a great purpose, a purpose that will change the
Time for inference 2: 150.13 sec total, time to first token 6.07 sec with sequential prefill, 255 tokens, 1.70 tokens/sec, 588.73 ms/token
Bandwidth achieved: 27.28 GB/s
Once upon a time, in the heart of the forest, there was a magnificent tree with branches that reached towards the sky. The tree was known as the Keeper of the Forest, and it was said that it held the secrets of the forest within its ancient heart.
One day, a young girl named Lily wandered into the forest, searching for adventure. She had heard stories of the Keeper of the Forest and was determined to find it. As she wandered deeper into the woods, she noticed that the trees seemed taller and the shadows seemed darker. She began to feel a sense of unease, but she pressed on, driven by her curiosity.

Finally, after many hours of walking, Lily came upon the magnificent tree. It towered above her, its branches reaching towards the sky like giant arms. Lily felt a sense of awe wash over her as she approached the tree. She reached out a hand to touch the trunk, and as she did, she felt a sudden surge of energy run through her body.

The tree began to speak to her in a low, rumbling voice. "Welcome, Lily," it said. "I have been waiting for you. You have come to ask me questions, but are you prepared to hear the truth?"

Lily was taken aback, but she nodded brav
Time for inference 3: 124.56 sec total, time to first token 1.72 sec with sequential prefill, 255 tokens, 2.05 tokens/sec, 488.47 ms/token
Bandwidth achieved: 32.88 GB/s

========================================

Average tokens/sec: 1.61
Memory used: 0.00 GB
